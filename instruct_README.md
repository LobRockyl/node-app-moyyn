# node-app-moyyn

## Manual Installation

If you would still prefer to do the installation manually, follow these steps:

Clone the repo:

```bash
git clone https://github.com/LobRockyl/node-app-moyyn.git
cd node-app-moyyn
npm install
npm start #to launch
```

## open .env and modify the environment variables (if needed) 
I have already included a mongodb url which is ready to use for ease.


## Project Structure

```
src\
 |--config\         # configuration related things
 |--controllers\    # controllers (controller layer)
 |--docs\           # swagger files
 |--middlewares\    # custom express middlewares
 |--models\         # mongoose models
 |--routes\         # routes
 |--services\       # business logic (service layer)
 |--utils\          # utility classes and functions
 |--validations\    # request data validation schemas
 |--app.js          # express app
 |--index.js        # entry point
```

## API Documentation

To view the list of available APIs and their specifications, run the server and go to `http://localhost:3000/docs` in your browser. This documentation page is automatically generated using the [swagger](https://swagger.io/) definitions written as comments in the route files.

### API Endpoints

List of available routes:

**Auth routes**:\
`POST /signup` - signup user\
`POST /login` - login user\
`POST /refresh-tokens` - refresh auth tokens\
`POST /forgot-password` - send reset password email(to check this please configure SMTP details in env file for email sending)\
`POST /reset-password` - reset user password

**User routes**:\
`POST /users` - create a new user - Only admins can create other users\ 
`GET /users` - get all users(Only admins can retrieve all users. This is done for security).\
`GET /users/:user_id` - get user Logged in users can fetch only their own user information. Only admins can fetch other users.\
`PATCH /users/:user_id` - update user Logged in users can only update their own details. Only admins can update other users.\
`DELETE /users/:user_id` - delete user Logged in users can delete only themselves. Only admins can delete other users.


If you would like an admin access account which I have already created. You can get the token by logging in with this details. If you input this token into the Authorize button in swagger ui(`http://localhost:3000/docs`) you will be able to access/modify all users.

```
{
  "email": "lob@example.com",
  "password": "password1"
}
```


## Error Handling

The app has a centralized error handling mechanism.
Request data is validated using [Joi](https://joi.dev/).
If the request does not contain a valid JWT token, an Unauthorized (401) error is thrown. Access token can be generated by making a successful call to the register (`POST /signup`) or login (`POST /login`) endpoints.
The auth middleware ensures security and authorization. The permissions are role-based. You can view the permissions/rights of each role in the `src/config/roles.js` file.
If the user making the request does not have the required permissions to access this route, a Forbidden (403) error is thrown.


The logging is done using the [Winston](https://github.com/winstonjs/winston) library.The logs are stored in ~/.pm2/logs. PM2 manages that and also logs info,warnings,errors.



